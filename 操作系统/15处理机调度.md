---
title: 处理机调度
date: 2016-11-15 21:46
category:
tags:
---

对于处理机调度有单核多核两种场景

## 时分复用
进程切换: 当前CPU资源的使用者切换, 需要为程序的执行上下文提供管理, 以便下次能恢复到之前的运行状态继续运行

## 调度算法
从就绪队列中取出一个进程, 并选择空闲CPU(或者符合抢占条件)来执行

进行调度需要考虑两点: 如何评估不同进程的优先级(which), 如何确定两个调度进程实际的调度时间点(when)

### 调度时机
- 内核执行调度的条件:
    - 进程(主动)从运行态切换到等待状态
    - 进程被终结
- 非抢占式系统:
    - 进程主动放弃CPU使用权
- 抢占式系统:
    - 中断请求被服务例程响应完成时
    - 当前进程被抢占
        - 进程时间片用完
        - 其他进程从等待转为就绪, 且拥有更高优先级

CPU内部与外部两方面

## 吞吐量与延迟
我们期望的调度算法能为我们带来更"快"的服务
这里的快其实有两层含义: 高吞吐量和低延迟

比如你用迅雷下东西, 当然是期望每秒的下载量越大, 而前期连接的耗时则是可以接受的
而当你玩电竞游戏时, 每秒交互的数据量并不大, 但是这时响应延迟则是不能忍受的

## 算法实现

- 先来先服务

- 短进程优先: 考虑到进程执行时间(同样用过去预测未来), 以提高周转时间(最优平均周转)

- 最高响应比: 以响应比为指标, 尽可能减少等待时间

- 时间片轮转
    - 额外的上下文切换(强制时钟中断)
    - 时间片的确定, 经验值: 维持上下文切换开销在1% 以下(10毫秒左右)

- 多级反馈队列: 不同子队列应用不同的调度算法, 可以综合各调度算法的特点

- 公平共享

## 优先级反置
基于优先级 + 可抢占式

解决方案: 优先级继承, 优先级天花板协议
